<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Clean HRU data table. — rvn_rvh_cleanhrus • RavenR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Clean HRU data table. — rvn_rvh_cleanhrus"><meta property="og:description" content="Takes rvn_rvh_read-generated HRUtable and SBTable and returns cleaned HRUtable
with (hopefully) fewer HRUs"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RavenR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Introduction_to_RavenR.html">Introduction to RavenR</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rchlumsk/RavenR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Clean HRU data table.</h1>
    <small class="dont-index">Source: <a href="https://github.com/rchlumsk/RavenR/blob/HEAD/R/rvn_rvh_cleanHRUs.R" class="external-link"><code>R/rvn_rvh_cleanHRUs.R</code></a></small>
    <div class="hidden name"><code>rvn_rvh_cleanhrus.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Takes <code><a href="rvn_rvh_read.html">rvn_rvh_read</a></code>-generated HRUtable and SBTable and returns cleaned HRUtable
with (hopefully) fewer HRUs</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rvn_rvh_cleanhrus</span><span class="op">(</span></span>
<span>  <span class="va">HRUtab</span>,</span>
<span>  <span class="va">SBtab</span>,</span>
<span>  area_tol <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  merge <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  elev_tol <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  slope_tol <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  aspect_tol <span class="op">=</span> <span class="fl">20</span>,</span>
<span>  ProtectedHRUs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  LockedHRUs <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  LockedSubbasins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>HRUtab</dt>
<dd><p>table of HRUs generated (typically) by <code><a href="rvn_rvh_read.html">rvn_rvh_read</a></code></p></dd>


<dt>SBtab</dt>
<dd><p>table of Subbasins generated (typically) by <code><a href="rvn_rvh_read.html">rvn_rvh_read</a></code></p></dd>


<dt>area_tol</dt>
<dd><p>percentage of watershed area beneath which HRUs should be removed (e.g.,
default value of 0.01 would indicate anything smaller than 1 percent of watershed extent should be removed)</p></dd>


<dt>merge</dt>
<dd><p>TRUE if similar HRUs are to be merged (this can be slow for large models)</p></dd>


<dt>elev_tol</dt>
<dd><p>elevation difference (in metres) considered similar. only used if <code>merge=TRUE</code></p></dd>


<dt>slope_tol</dt>
<dd><p>slope difference (in degrees) considered similar. only used if <code>merge=TRUE</code></p></dd>


<dt>aspect_tol</dt>
<dd><p>slope difference (in degrees) considered similar. only used if <code>merge=TRUE</code></p></dd>


<dt>ProtectedHRUs</dt>
<dd><p>vector of HRU IDs that are sacrosanct (not to be removed, but may still increase in area)</p></dd>


<dt>LockedHRUs</dt>
<dd><p>vector of HRU IDs that are locked (not to be modified)</p></dd>


<dt>LockedSubbasins</dt>
<dd><p>vector of subbasin IDs that are locked (not to be modified).</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>hru_table</dt>
<dd><p>cleaned HRU table as a dataframe</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p><code>rvn_rvh_cleanhrus</code> removes HRUs in two ways:</p>
<p>1. it removes all HRUs smaller than the area_tol percentage of total area. Adjacent HRUs in the
subbasin are expanded by the lost area to keep the same relative coverage.</p>
<p>2. it consolidates similar HRUs within the same subbasin (those with same land cover,
    vegetation, soil profile and similar slope, aspect, and elevation)</p>
<p>The ProtectedHRUs allows the specification of HRUs that should not be removed, even if they
would otherwise be merged or removed. These HRUs may still increase in size as other HRUs are
consolidated.</p>
<p>The LockedHRUs allows for the specification of HRUs that will not change (removed or increase
in size), which may be useful for specific land types such as glaciers or water bodies. It is
possible that locking HRUs may prevent the script from resizing remaining HRUs within a subbasin,
in which case a warning is issued to the user that the area has changed. If this is the case, it
is suggested to reduce the area threshold to try and prevent this issue, or consider simply locking some
subbasins.</p>
<p>Note that merging can be a computationally expensive process, and for this reason is set as <code>FALSE</code> by default.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="rvn_rvh_read.html">rvn_rvh_read</a></code> for the function used to read in the HRU and Subbasin data, and
<code><a href="rvn_rvh_write.html">rvn_rvh_write</a></code> to write rvh information to file.</p></div>
    </div>
    <div id="author">
    <h2>Author</h2>
    <p>James R. Craig, University of Waterloo</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># read in example rvh file</span></span></span>
<span class="r-in"><span><span class="va">nith</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"Nith.rvh"</span>,package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">rvh</span> <span class="op">&lt;-</span> <span class="fu"><a href="rvn_rvh_read.html">rvn_rvh_read</a></span><span class="op">(</span><span class="va">nith</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># number of HRUs in existing configuration</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">rvh</span><span class="op">$</span><span class="va">HRUtable</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 32</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># clean contents (in this case, remove all HRUs covering less than 5% of the total area)</span></span></span>
<span class="r-in"><span><span class="va">newHRUs</span> <span class="op">&lt;-</span> <span class="fu">rvn_rvh_cleanhrus</span><span class="op">(</span><span class="va">rvh</span><span class="op">$</span><span class="va">HRUtable</span>,<span class="va">rvh</span><span class="op">$</span><span class="va">SBtable</span>,area_tol <span class="op">=</span> <span class="fl">0.05</span>, merge<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "HRU table Cleaned. #HRUs reduced from 32 to 25; 0 HRUs protected and 0 HRUs locked"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "7 HRUs failed area tolerance test (48.6 km2 (4.8%) recategorized)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0 HRUs failed similarity tolerance test"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Initial area: 1014.4 km2;  final area: 1014.4 km2"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># clean contents but locking urban areas (two HRUs locked)</span></span></span>
<span class="r-in"><span><span class="va">newHRUs</span> <span class="op">&lt;-</span> <span class="fu">rvn_rvh_cleanhrus</span><span class="op">(</span><span class="va">rvh</span><span class="op">$</span><span class="va">HRUtable</span>,<span class="va">rvh</span><span class="op">$</span><span class="va">SBtable</span>,area_tol <span class="op">=</span> <span class="fl">0.05</span>, merge<span class="op">=</span><span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>   LockedHRUs<span class="op">=</span><span class="va">rvh</span><span class="op">$</span><span class="va">HRUtable</span><span class="op">[</span><span class="va">rvh</span><span class="op">$</span><span class="va">HRUtable</span><span class="op">$</span><span class="va">LandUse</span><span class="op">==</span><span class="st">"URBAN"</span>, <span class="st">"ID"</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "HRU table Cleaned. #HRUs reduced from 32 to 27; 0 HRUs protected and 2 HRUs locked"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "5 HRUs failed area tolerance test (36.4 km2 (3.6%) recategorized)"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "0 HRUs failed similarity tolerance test"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Initial area: 1014.4 km2;  final area: 1014.4 km2"</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robert Chlumsky, James Craig, Leland Scantlebury, Simon Lin, Sarah Grass, Genevieve Brown, Rezgar Arabzadeh.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

