<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>EC Climate Station File Conversion — rvn_rvt_write_met • RavenR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="EC Climate Station File Conversion — rvn_rvt_write_met"><meta property="og:description" content="Converts meteorological data for a given station into the
Raven .rvt format."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RavenR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Introduction_to_RavenR.html">Introduction to RavenR</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rchlumsk/RavenR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>EC Climate Station File Conversion</h1>
    <small class="dont-index">Source: <a href="https://github.com/rchlumsk/RavenR/blob/HEAD/R/rvn_rvt_write_met.R" class="external-link"><code>R/rvn_rvt_write_met.R</code></a></small>
    <div class="hidden name"><code>rvn_rvt_write_met.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Converts meteorological data for a given station into the
Raven .rvt format.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rvn_rvt_write_met</span><span class="op">(</span></span>
<span>  <span class="va">metdata</span>,</span>
<span>  rvt_met_mapping <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  filenames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  met_file_prefix <span class="op">=</span> <span class="st">"met_"</span>,</span>
<span>  prd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  write_stndata <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  filename_stndata <span class="op">=</span> <span class="st">"met_stndata.rvt"</span>,</span>
<span>  NA_value <span class="op">=</span> <span class="op">-</span><span class="fl">1.2345</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>metdata</dt>
<dd><p>EC meteorological data from one or more stations (e.g., from <code>weathercan::weather_dl()</code>)</p></dd>


<dt>rvt_met_mapping</dt>
<dd><p>list that provides the mapping between metdata names and those used in Raven</p></dd>


<dt>filenames</dt>
<dd><p>(optional) character vector of filenames for the rvt data files, length same as number of stations in metdata</p></dd>


<dt>met_file_prefix</dt>
<dd><p>(optional) prefixes the file name (default: "met_")</p></dd>


<dt>prd</dt>
<dd><p>(optional) data period to use in .rvt file</p></dd>


<dt>write_stndata</dt>
<dd><p>(optional) write the gauge data to a separate .rvt file</p></dd>


<dt>filename_stndata</dt>
<dd><p>(optional) name of the station data file created (if <code>write_stndata=TRUE</code>)</p></dd>


<dt>NA_value</dt>
<dd><p>(optional) value to use for NA values in rvt file (default -1.2345 for Raven format)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>TRUE</dt>
<dd><p>return <code>TRUE</code> if the function is executed properly</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Writes data in either :Data or :MultiData format depending on the number of
supported parameter columns provided. The data should be downloaded and prepared
with missing days included, and preferably is downloaded directly using <code>weathercan</code>.</p>
<p>metdata contains all of the meteorological data to be written to file. metdata should be
in a tibble or data frame format, and is required to have a date/time column (either DATE,
TIME, or DATETIME, all of which have at least a Date component), the STATION_NAME,
and all desired forcings to be written to file. If the columns ELEV, LAT, LON are included,
the station meta data may be written to a separate rvt file as well (see below). All supported
data columns in metdata are written into rvt format, so the desired columns
for the rvt file should be passed through metdata and filtered first if needed.</p>
<p>rvt_met_mapping is a list that maps the metdata column names to Raven variables. If
<code>weathercan</code> is used then this may be left NULL, as the mapping is automatically provided.
Otherwise, the user must convert all desired column names to Raven-recognized names, or
provide the mapping information as a list through this parameter. An example format can be seen
(the mapping used for weathercan by default) in <code>data("rvn_rvt_mappings_data")</code>.</p>
<p>filenames may be used to provide the specific desired filenames (with paths) for each
station rvt data file being generated; this should be a character vector of length
equal to the number of unique station names in the data.</p>
<p>Note that the function uses
<code>sort(unique(metdata$STATION_NAME))</code> to determine the order of stations,
thus the filenames should correspond to the sorted vector of station numbers as well.</p>
<p>prd is used by the xts formatted-data to restrict the data reported in .rvt
files, for each station, to this period. The prd should be defined in
"YYYY-MM-DD/YYYY-MM-DD" string format. If the period supplied results in an
empty time series (i.e. non-overlapping time periods), an error will be
thrown.</p>
<p>met_file_prefix can be used to add a prefix to the .rvt data file names, ("met_" by default)
which may be useful in organizing multiple climate data files. This is ignored
if filenames are specified.</p>
<p>write_stndata wil print out the gauge(s) metadata to file (specified by
filename_stndata parameter) in the .rvt format, which is required to include a
meterological station in Raven. The function will append to the file if it already exists, meaning
that this works for iterations of this function. metdata must include the columns
ELEV, LAT, and LON if station data is to be written, else the meta data file will not be created.</p>
<p>The function has several built-in data quality checks. These include:</p>
<p>* checking that the time interval is consistent for each station;
* ensuring that meta data is unique for each station name; and
* check for missing data and issuing a warning that post-processing will be required</p>
<p>Data quality is not assessed in this package, such as consistency between
minimum and maximum temperatures and missing data. Consider viewing the RavenR.extras package for
functions to interpolate missing meteorological data and checking for min/max temperature consistency.</p>
<p>This function is designated to use data from the weathercan package, but may be used with any
supplied data frame of meteorological information if in the correct format and other
relevant information (such as rvt_met_mapping, if needed) is supplied. The
weathercan package is external to RavenR and is not an explicit dependency
of RavenR, although a sample weathercan data set can be viewed as <code>data(rvn_weathercan_sample)</code>.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="rvn_rvt_write.html">rvn_rvt_write</a></code> to write non-forcing time series data to Raven rvt format.</p>
<p>Download Environment Canada Historical weather data from (climate.weather.gc.ca), or use the
`weathercan` package to access this data through R.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># note: example modified to avoid using weathercan directly, uses saved</span></span></span>
<span class="r-in"><span><span class="co">## weathercan data from RavenR package sample data</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rvn_weathercan_sample</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">kam</span> <span class="op">&lt;-</span> <span class="va">rvn_weathercan_sample</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># basic use, override filename to temporary file</span></span></span>
<span class="r-in"><span><span class="fu">rvn_rvt_write_met</span><span class="op">(</span>metdata <span class="op">=</span> <span class="va">kam</span>,</span></span>
<span class="r-in"><span>  filenames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"rvn_rvt_metfile.rvt"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename_stndata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"met_stndata.rvt"</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "Imported data from 1 station"</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>NA values detected for station KAMLOOPS_A and set to NA value (-1.2345) in time series.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> Note that met forcings cannot have NA values in Raven.</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> rvn_rvt_write_met: Done writing to /tmp/RtmpHgtHbS/rvn_rvt_metfile.rvt</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> rvn_rvt_write_met: Done writing rvt files for 1 station(s)</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> rvn_rvt_write_met: Done writing station data to /tmp/RtmpHgtHbS/met_stndata.rvt</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robert Chlumsky, James Craig, Leland Scantlebury, Simon Lin, Sarah Grass, Genevieve Brown, Rezgar Arabzadeh.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

