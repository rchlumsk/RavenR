<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>EC Streamgauge File Conversion from tidyhydat — rvn_rvt_tidyhydat • RavenR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="EC Streamgauge File Conversion from tidyhydat — rvn_rvt_tidyhydat"><meta property="og:description" content="rvn_rvt_tidyhydat converts Environment Canada historical streamgauge data,
accessed via the tidyhydat package, into .rvt format files usable in
Raven."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RavenR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Introduction_to_RavenR.html">Introduction to RavenR</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rchlumsk/RavenR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>EC Streamgauge File Conversion from tidyhydat</h1>
    <small class="dont-index">Source: <a href="https://github.com/rchlumsk/RavenR/blob/HEAD/R/rvn_rvt_tidyhydat.R" class="external-link"><code>R/rvn_rvt_tidyhydat.R</code></a></small>
    <div class="hidden name"><code>rvn_rvt_tidyhydat.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>rvn_rvt_tidyhydat converts Environment Canada historical streamgauge data,
accessed via the tidyhydat package, into .rvt format files usable in
Raven.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rvn_rvt_tidyhydat</span><span class="op">(</span></span>
<span>  <span class="va">indata</span>,</span>
<span>  rvt_type <span class="op">=</span> <span class="st">"ObservationData"</span>,</span>
<span>  data_type <span class="op">=</span> <span class="st">"HYDROGRAPH"</span>,</span>
<span>  <span class="va">subIDs</span>,</span>
<span>  prd <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  stnNames <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  write_redirect <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  flip_number <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  rd_file <span class="op">=</span> <span class="st">"flow_stn_redirect_text.rvt"</span>,</span>
<span>  filename <span class="op">=</span> <span class="cn">NULL</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>indata</dt>
<dd><p>tibble of WSC flow data from tidyhydat's hy_daily_flows() function</p></dd>


<dt>rvt_type</dt>
<dd><p>type of rvt file to write (e.g. ObservationData, BasinInflowHydrograph, etc.)</p></dd>


<dt>data_type</dt>
<dd><p>Raven-syntax data type for flow data (default 'HYDROGRAPH')</p></dd>


<dt>subIDs</dt>
<dd><p>vector of subbasin IDs to correspond to the stations in indata</p></dd>


<dt>prd</dt>
<dd><p>(optional) data period to use in .rvt file</p></dd>


<dt>stnNames</dt>
<dd><p>(optional) character vector of alternative station names to use</p></dd>


<dt>write_redirect</dt>
<dd><p>(optional) write the :RedirectToFile commands in a separate .rvt file</p></dd>


<dt>flip_number</dt>
<dd><p>(optional) put the subID first in the .rvt filename</p></dd>


<dt>rd_file</dt>
<dd><p>(optional) name of the redirect file created (if <code>write_redirect=TRUE</code>)</p></dd>


<dt>filename</dt>
<dd><p>specified name of file(s) to write to (optional)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>TRUE</dt>
<dd><p>return TRUE if the function is executed properly</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>Takes a single flow tibble generated from tidyhydat and converts the flow data for
each station in the file into .rvt formatted files for a Raven model. If
multiple stations exist in indata, multiple observation files are created. This function
is a wrapper for <code>rvn_rvt_write</code>, with the benefit of automatically parsing the
tidyhydat download for possibly multiple stations in xts formats before passing
to the rvt writing function.</p>
<p>rvt_type is the specified rvt file type to write to (see the Raven User's Manual
or the <code>rvn_rvt_mappings</code> function for more rvt types). This should be a flow-based
rvt type, such as ObservationData, BasinInflowHydrograph, ReservoirExtraction, etc.
Most applications of this will likely write the tidyhydat observations as
ObservedData for use in model evaluation to historic records.</p>
<p>data_type is the type of Raven input data type, likely 'HYDROGRAPH', for the corresponding
flow data. If the flow is used as a reservoir-related flow, the data_type may be
RESERVOIR_INFLOW or RESERVOIR_NETINFLOW.</p>
<p>subIDs is required and should correspond to the subID to be used in the .rvt
file for each station in the ff file, in the order in which it will be read
in.</p>
<p>prd is used by the xts formatted-data to restrict the data reported in .rvt
files, for each station, to this period. The prd should be defined in
"YYYY-MM-DD/YYYY-MM-DD" string format. If the period supplied results in an
empty time series (i.e. non-overlapping time periods), an error will be
thrown.</p>
<p>stnNames is an optional character vector to replace the EC station codes
found in the HYDAT database. If supplied, the vector must be of the same length
as the number of stations supplied and the subIDs vector. If not supplied,
the EC station codes will be used. Note that this does not impact model
function, only filename readability and station recognition.</p>
<p>write_redirect will print out the :RedirectToFile commands in a separate
file called, "flow_stn_redirect_text.rvt". These commands can be copied into
the main model's .rvt file to redirect to the produced time series files.</p>
<p>flip_number is a useful option to place the subID first in the filename.
This is often cleaner for organizing files in a folder, since the
alphabetized order is not dependent on the station name, and the observed
files will be in one set.</p>
<p>The function will write to name generated from the station name(s), otherwise
the .rvt filename may be specified with the filename argument (full path to
the filename, including .rvt extension). If multiple stations are provided,
the filename argument may be a vector of filenames.</p>
<p>Note that the function uses
<code>sort(unique(indata$STATION_NUMBER))</code> to determine the order of stations,
thus the filenames and stnNames should correspond to the sorted vector of station numbers as well.</p>
<p>Note that only daily flow data is supported, as tidyhydat only allows for the
download of daily (or coarser resolution) flow data. Hourly data that is obtained
must be first processed into xts format and then written with <code><a href="rvn_rvt_write.html">rvn_rvt_write</a></code>.</p>
<p>If the data is found to have an inconsistent timestep, the function will attempt to correct it
by infilling missing time steps with <code><a href="rvn_ts_infill.html">rvn_ts_infill</a></code>. If successful, a warning is issued
to the user and the function will proceed, else an error will be raised.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># note: example modified to avoid using tidyhydat directly, uses saved</span></span></span>
<span class="r-in"><span><span class="co">## tidyhydat data from RavenR package sample data</span></span></span>
<span class="r-in"><span><span class="co"># library(tidyhydat)</span></span></span>
<span class="r-in"><span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"05CB004"</span>,<span class="st">"05CA002"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Gather station data/info using tidyhydat functions</span></span></span>
<span class="r-in"><span><span class="co"># hd &lt;- tidyhydat::hy_daily_flows(station_number = stations,</span></span></span>
<span class="r-in"><span><span class="co">#  start_date = "1996-01-01", end_date = "1997-01-01")</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rvn_tidyhydat_sample</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">hd</span> <span class="op">&lt;-</span> <span class="va">rvn_tidyhydat_sample</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># station_info &lt;- hy_stations(stations)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">tf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"station1.rvt"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">tf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"station2.rvt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create RVT files</span></span></span>
<span class="r-in"><span><span class="fu">rvn_rvt_tidyhydat</span><span class="op">(</span><span class="va">hd</span>, subIDs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">11</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  filename<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tf1</span>,<span class="va">tf2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] TRUE</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robert Chlumsky, James Craig, Leland Scantlebury, Simon Lin, Sarah Grass, Genevieve Brown, Rezgar Arabzadeh.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

