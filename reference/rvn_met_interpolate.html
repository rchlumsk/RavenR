<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Interpolate meteorological data using IDW — rvn_met_interpolate • RavenR</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Interpolate meteorological data using IDW — rvn_met_interpolate"><meta property="og:description" content="Interpolates/infills missing meteorological data by
using an inverse-distance weighting scheme to infill using data from nearby
meteorological stations; issues where maximum temperature is less than minimum
temperature can also be resolved."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RavenR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/Introduction_to_RavenR.html">Introduction to RavenR</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/rchlumsk/RavenR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Interpolate meteorological data using IDW</h1>
    <small class="dont-index">Source: <a href="https://github.com/rchlumsk/RavenR/blob/HEAD/R/rvn_met_interpolate.R" class="external-link"><code>R/rvn_met_interpolate.R</code></a></small>
    <div class="hidden name"><code>rvn_met_interpolate.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Interpolates/infills missing meteorological data by
using an inverse-distance weighting scheme to infill using data from nearby
meteorological stations; issues where maximum temperature is less than minimum
temperature can also be resolved.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">rvn_met_interpolate</span><span class="op">(</span></span>
<span>  weather_data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  cc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"max_temp"</span>, <span class="st">"min_temp"</span>, <span class="st">"total_precip"</span><span class="op">)</span>,</span>
<span>  key_stn_ids <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  ppexp <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  fix_interp_temp <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  fix_base_temp <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  min_dist <span class="op">=</span> <span class="fl">100</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>weather_data</dt>
<dd><p>data frame of input meteorological data from multiple stations</p></dd>


<dt>cc</dt>
<dd><p>columns from weather_data to infill missing values in</p></dd>


<dt>key_stn_ids</dt>
<dd><p>station IDs in which to perform the interpolation</p></dd>


<dt>ppexp</dt>
<dd><p>exponent to use in inverse distance weighting calculation (default 2)</p></dd>


<dt>fix_interp_temp</dt>
<dd><p>function will swap interpolated min and max temp if appropriate</p></dd>


<dt>fix_base_temp</dt>
<dd><p>function will swap any min and max temp if appropriate</p></dd>


<dt>min_dist</dt>
<dd><p>minimum distance used in IDW to avoid issues with stations of different IDs but exact same coordinates (default 100m)</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    <dl><dt>new_wd</dt>
<dd><p>infilled meteorological data set</p></dd>

</dl></div>
    <div id="details">
    <h2>Details</h2>
    <p>This function takes a meteorological data set with multiple station data in one data frame and
interpolates the missing values for key stations, for the specified meteorological variables to interpolate.</p>
<p>The format of the weather_data input is consistent with that from the <code>weathercan::weather_dl</code>
function, which is the recommended tool to gather this input (see the examples).</p>
<p>This function does not guarantee to infill all missing values, since this depends on the availability of data
at other locations when it lacks at a given station, although a warning is issued if
missing values remain following the interpolation. If this is encountered, it may be prudent to consider
including additional stations in the available data for interpolation and/or applying alternative
interpolation schemes in conjunction with <code>rvn_met_interpolate</code>.</p>
<p>This function does not (currently) perform checks for the quality of the supplied or infilled data,
such as checking for maximum temperature less than minimum temperature, unreasonable precipitation values, etc.</p>
<p>The key_stn_ids indicates which stations should have their missing values interpolated. It is likely that
the user will require more data to perform a proper interpolation than the user cares to have gauge
records at, i.e. some stations are only provided for the purposes of infilling missing data at other stations.
Since the interpolation of all stations provided can become computationally expensive, the user can
specify which stations they want to interpolate data for with the key_stn_ids parameter. Station IDs that
are not within the key_stn_ids (if not NULL) will still be used, but not themselves infilled.</p>
<p>fix_interp_temp is a boolean for the function to swap any max_temp and min_temp fields where the maximum
temperature is less than the minimum temperature, a common fix in messy environmental data. This function
will only apply if the columns <code>max_temp</code> and <code>min_temp</code> are present, and will only apply to the
interpolated fields. By default this is enabled, and automatic fixes to interpolated data will be done;
supplied data where the max temp is less than min temp will not be fixed unless fix_base_temp is enabled.</p>
<p>The distance calculation, estimating the distance between stations, is performed using the
<code><a href="rvn_dist_lonlat.html">rvn_dist_lonlat</a></code> function, which is based on the <code>geosphere</code> package. The min_dist is
included to provide a minimum distance used in IDW, and avoid issues with stations of different names and IDs but
the same coordinates. This can occur when stations upgrade or are reinstated at a later time in the same location,
which would otherwise result in a div/0 error in the IDW calculation.</p>
    </div>
    <div id="see-also">
    <h2>See also</h2>
    <div class="dont-index"><p><code><a href="rvn_rvt_write_met.html">rvn_rvt_write_met</a></code> for writing meteorological data sets to rvt format.</p></div>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span></span>
<span class="r-in"><span><span class="co">## NOT RUN (downloads data + long runtime)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># example to create infilled data sets</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">weathercan</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">stn</span> <span class="op">&lt;-</span> <span class="fu">weathercan</span><span class="fu">::</span><span class="fu">stations_search</span><span class="op">(</span>name<span class="op">=</span><span class="st">"Glen allan"</span>, interval <span class="op">=</span> <span class="st">"day"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">dl_stn</span> <span class="op">&lt;-</span> <span class="va">stn</span></span></span>
<span class="r-in"><span><span class="va">all_stns</span> <span class="op">&lt;-</span> <span class="fu">weathercan</span><span class="fu">::</span><span class="fu">stations_search</span><span class="op">(</span>coords<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">stn</span><span class="op">$</span><span class="va">lat</span>, <span class="va">stn</span><span class="op">$</span><span class="va">lon</span><span class="op">)</span>, dist<span class="op">=</span><span class="fl">40</span>,</span></span>
<span class="r-in"><span>          interval<span class="op">=</span><span class="st">"day"</span>, starts_latest <span class="op">=</span> <span class="fl">2002</span>,</span></span>
<span class="r-in"><span>          ends_earliest <span class="op">=</span> <span class="fl">2010</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># download data with weathercan::weather_dl()</span></span></span>
<span class="r-in"><span><span class="va">weather_data</span> <span class="op">&lt;-</span> <span class="fu">weather_dl</span><span class="op">(</span>station_ids <span class="op">=</span> <span class="va">all_stns</span><span class="op">$</span><span class="va">station_id</span>,</span></span>
<span class="r-in"><span>                            start <span class="op">=</span> <span class="st">"2002-10-01"</span>,</span></span>
<span class="r-in"><span>                            end <span class="op">=</span> <span class="st">"2005-10-01"</span>,</span></span>
<span class="r-in"><span>                            interval<span class="op">=</span><span class="st">"day"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># define first three as key stations of interest for infilling</span></span></span>
<span class="r-in"><span><span class="va">dl_stn</span> <span class="op">&lt;-</span> <span class="va">all_stns</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># confirm missing data in key columns</span></span></span>
<span class="r-in"><span><span class="va">key_cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"min_temp"</span>,<span class="st">"max_temp"</span>,<span class="st">"total_precip"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">weather_data</span><span class="op">[</span>,<span class="va">key_cols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># perform interpolation for key stns (3) using all stations downloaded (5)</span></span></span>
<span class="r-in"><span><span class="va">new_wd</span> <span class="op">&lt;-</span> <span class="fu">rvn_met_interpolate</span><span class="op">(</span>weather_data <span class="op">=</span> <span class="va">weather_data</span>,</span></span>
<span class="r-in"><span>                               key_stn_ids <span class="op">=</span> <span class="va">dl_stn</span><span class="op">$</span><span class="va">station_id</span>,</span></span>
<span class="r-in"><span>                               cc <span class="op">=</span> <span class="va">key_cols</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># no warning - confirm no missing values in key columns</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">new_wd</span><span class="op">[</span>,<span class="va">key_cols</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Robert Chlumsky, James Craig, Leland Scantlebury, Simon Lin, Sarah Grass, Genevieve Brown, Rezgar Arabzadeh.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer></div>

  


  

  </body></html>

