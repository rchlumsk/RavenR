<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to RavenR • RavenR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to RavenR">
<meta property="og:description" content="RavenR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">RavenR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction_to_RavenR.html">Introduction to RavenR</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rchlumsk/RavenR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to RavenR</h1>
                        <h4 data-toc-skip class="author">Robert
Chlumsky, Dr. James R. Craig</h4>
            
            <h4 data-toc-skip class="date">May 9, 2022</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rchlumsk/RavenR/blob/HEAD/vignettes/Introduction_to_RavenR.Rmd" class="external-link"><code>vignettes/Introduction_to_RavenR.Rmd</code></a></small>
      <div class="hidden name"><code>Introduction_to_RavenR.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="introduction-to-ravenr-tutorial">Introduction to RavenR Tutorial<a class="anchor" aria-label="anchor" href="#introduction-to-ravenr-tutorial"></a>
</h2>
<p>This short document is intended to get you started with using
<code>RavenR</code> to aid your analysis with the Raven Hydrologic
Modelling Framework. This tutorial will get you up and running with the
<code>RavenR</code> package and comfortable running a few commands. Some
knowledge or R is presumed in this document. If you are not comfortable
with R, take a look at any number of R training and Introductory
resources, such as the <a href="https://github.com/rchlumsk/tRaining" class="external-link">tRaining repository</a>) on
Github.</p>
<p>This exercise will use the Nith River modelled output available from
within the RavenR package, thus the functions to read in data from csv
files are not required. However, it is recommended that you download the
Nith river model files, and try to both run the model and read in the
output files. The Nith river model can be downloaded from the <a href="http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html" class="external-link">Raven
Tutorial #2</a>.</p>
<p>Note that the <code>RavenR</code> package is focused on handling
Raven input/output files, model diagnostics, and generating plots with
the <code>ggplot2</code> library. The dependencies required by the
package are kept at a relative minimum to preserve stability. An
additional package, <code>RavenR.extras</code>, is available on <a href="https://github.com/rchlumsk/RavenR.extras" class="external-link">Github</a> and contains
additional functionality.</p>
<div class="section level3">
<h3 id="getting-acquainted-with-ravenr">Getting Acquainted with RavenR<a class="anchor" aria-label="anchor" href="#getting-acquainted-with-ravenr"></a>
</h3>
<p>If you don’t have RavenR yet installed in your R library, run the
following commands to install the RavenR package directly from the
Comprehensive R Archive Network (CRAN), which is available on <a href="https://CRAN.R-project.org/package=RavenR" class="external-link">CRAN</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"RavenR"</span><span class="op">)</span></span></code></pre></div>
<p>For those interested in the latest versions of RavenR or in
contributing to the development of RavenR, the package may be found on
<a href="https://github.com/rchlumsk/RavenR" class="external-link">Github</a> at <a href="https://github.com/rchlumsk/RavenR" class="external-link uri">https://github.com/rchlumsk/RavenR</a>. Packages on Github
may also be installed from within R using the <code>devtools</code>
library with the code below.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://remotes.r-lib.org/reference/install_github.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"rchlumsk/RavenR"</span><span class="op">)</span></span></code></pre></div>
<p>Load the RavenR library from the console and view its contents with
the following commands:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rchlumsk/RavenR" class="external-link">RavenR</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># view first 20 functions in RavenR</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/ls.html" class="external-link">ls</a></span><span class="op">(</span><span class="st">"package:RavenR"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">20</span><span class="op">)</span> </span></code></pre></div>
<p>Each function in the package is documented, which includes a
description of the function, its inputs and outputs, and an example. You
can look at any of the function examples by typing out the name of the
function beginning with a question mark, which will show the help
information at the right of the RStudio environment.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">rvn_flow_scatterplot</span></span></code></pre></div>
<p>The name of each external function in the RavenR package begins with
the “rvn_” prefix, so you in practice ‘search’ for functions by
beginning to type them out. Try this to see what functions are available
with “rvn_rvh_”.</p>
</div>
<div class="section level3">
<h3 id="sample-data-in-ravenr">Sample Data in RavenR<a class="anchor" aria-label="anchor" href="#sample-data-in-ravenr"></a>
</h3>
<p>The RavenR package contains a number of sample data files, which are
useful for training purposes and testing of functions. The package
contains sample data both in R format (under RavenR/data) and as raw
data files in their native formats (RavenR/inst/extdata). The sample
data set from the RavenR package (in R format) can be loaded in using
the data function (with either quotes or just the name of the data),
e.g.,</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"rvn_forcing_data"</span><span class="op">)</span></span>
<span><span class="co"># ?rvn_forcing_data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rvn_forcing_data</span><span class="op">$</span><span class="va">forcings</span><span class="op">$</span><span class="va">temp_daily_ave</span>,</span>
<span>     main<span class="op">=</span><span class="st">"Daily Avg. Temperature"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/R%20sample%20data-1.png" width="700"></p>
<p>Notice as well that the sample data set in R format also has a built
in help file to describe the data.</p>
<p>To locate the raw data from the RavenR package, we will use a syntax
to find the data by file name in the RavenR package directory, which
ends up looking more similar to a raw file call. This raw data file
comes from the <strong>inst/extdata</strong> folder in the RavenR
package. Note that this is done so that the sample data in raw format
can be used and tested with functions, and the syntax to locate the data
file is more portable across various computer operating systems.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in hydrograph sample csv data from RavenR package</span></span>
<span><span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"run1_Hydrographs.csv"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ff is a simple string, which can be substituted with any file location</span></span>
<span><span class="va">ff</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "/home/runner/work/_temp/Library/RavenR/extdata/run1_Hydrographs.csv"</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in sample rvi file from the RavenR package</span></span>
<span><span class="va">rvi_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"Nith.rvi"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># show first 6 lines of the file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">rvi_file</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "# ----------------------------------------------"</span></span>
<span><span class="co">## [2] "# Raven Input file"                              </span></span>
<span><span class="co">## [3] "# HBV-EC Nith River emulation test case"         </span></span>
<span><span class="co">## [4] "# ----------------------------------------------"</span></span>
<span><span class="co">## [5] "# --Simulation Details -------------------------"</span></span>
<span><span class="co">## [6] ":StartDate       2002-10-01 00:00:00"</span></span></code></pre>
<p>The <code>system.file</code> command will simply build a file path
for where this data file is located on your machine with the RavenR
package installation, which can then be passed to any function as
required to provide a file location. This command will be used
throughout this tutorial in place of local files for portability,
however, your own data files may be swapped in place of the system.file
locations. For example, you may wish to pass files from other Raven
Tutorial files by changing the file paths throughout this tutorial.</p>
</div>
<div class="section level3">
<h3 id="diagnostics-and-plotting">Diagnostics and Plotting<a class="anchor" aria-label="anchor" href="#diagnostics-and-plotting"></a>
</h3>
<p>Now you are ready to start using RavenR to directly visualize and
manipulate model output. This section of the exercise will make use of
raw sample data in the RavenR package to illustrate some of the
diagnostics and plotting capabilities of RavenR.</p>
<div class="section level4">
<h4 id="forcing-functions">Forcing Functions<a class="anchor" aria-label="anchor" href="#forcing-functions"></a>
</h4>
<p>Start by finding the raw <strong>run1_ForcingFunctions.csv</strong>
file with the <code>system.file</code> command. Note that this can be
replaced with your own forcing functions file location if preferred. We
will store the forcing functions data into an object called ff (and
obtain just the subobject using the ‘$’ operator), and then view the
first few rows using the <strong>head</strong> function. We will show
only the first six columns of the data for brevity.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"run1_ForcingFunctions.csv"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span></span>
<span><span class="co"># ff &lt;- "C:/TEMP/Nith/output/ForcingFunctions.csv" # replace with your own file</span></span>
<span><span class="va">ff_data</span> <span class="op">&lt;-</span> <span class="fu">RavenR</span><span class="fu">::</span><span class="fu"><a href="../reference/rvn_forcings_read.html">rvn_forcings_read</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ff_data</span><span class="op">$</span><span class="va">forcings</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            day_angle     rain snow    temp temp_daily_min temp_daily_max</span></span>
<span><span class="co">## 2002-10-01   4.70809 3.468690    0 22.5956       17.92510        27.2662</span></span>
<span><span class="co">## 2002-10-02   4.70809 3.468690    0 22.5956       17.92510        27.2662</span></span>
<span><span class="co">## 2002-10-03   4.72530 1.189180    0 19.2076       15.40780        23.0075</span></span>
<span><span class="co">## 2002-10-04   4.74251 2.083260    0 13.3714       11.49870        15.2440</span></span>
<span><span class="co">## 2002-10-05   4.75973 6.474310    0 19.0304       12.50970        25.5510</span></span>
<span><span class="co">## 2002-10-06   4.77694 0.125591    0 11.0186        7.43466        14.6024</span></span></code></pre>
<p>Now we can plot the forcing data using the rvn_forcings_plot
function. This creates an output of the five main forcings from the data
set, from which we can plot one or more forcings, including a plot of
the whole set of plots. This is typically a reasonable reality check on
the model forcings.</p>
<p>Here, we plot the PET from the set of created plots.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_forcings_plot.html">rvn_forcings_plot</a></span><span class="op">(</span><span class="va">ff_data</span><span class="op">$</span><span class="va">forcings</span><span class="op">)</span></span>
<span><span class="co"># myplots$Temperature</span></span>
<span><span class="co"># myplots$Radiation</span></span>
<span><span class="co"># myplots$AllForcings</span></span>
<span><span class="va">myplots</span><span class="op">$</span><span class="va">PET</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Plot%20forcing%20data-1.png" width="700"></p>
<p>The legend for the forcing plot functions is turned off by default,
but can be added back in using the <code>theme</code> function from
<code>ggplot2</code> to add the legend to the plot.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">myplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_forcings_plot.html">rvn_forcings_plot</a></span><span class="op">(</span><span class="va">ff_data</span><span class="op">$</span><span class="va">forcings</span><span class="op">)</span></span>
<span><span class="va">myplots</span><span class="op">$</span><span class="va">Radiation</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Plot%20forcing%20data%20with%20labels-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="hydrograph-and-diagnostics">Hydrograph and Diagnostics<a class="anchor" aria-label="anchor" href="#hydrograph-and-diagnostics"></a>
</h4>
<p>We can similarly access the hydrograph fit. Here the hydrograph
sample data is located with the usual <code>system.file</code> command,
then read into R with the <code>rvn_hyd_read</code> function intended
for reading Hydrographs file. The flows from a specific subbasin can be
extracted using the <code>rvn_hyd_extract</code> function, which is done
here for subbasin 36. The precipitation can be extracted similarly.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ff</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"run1_Hydrographs.csv"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span></span>
<span><span class="co"># ff &lt;- "mydirectory/Hydrographs.csv" # replace with your own file</span></span>
<span><span class="va">hy</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_hyd_read.html">rvn_hyd_read</a></span><span class="op">(</span><span class="va">ff</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">hy</span><span class="op">$</span><span class="va">hyd</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##              precip    Sub36 Sub36_obs    Sub43 Sub43_obs</span></span>
<span><span class="co">## 2002-10-01       NA  5.96354        NA 11.25050        NA</span></span>
<span><span class="co">## 2002-10-02 3.468690 11.96430     0.801 18.59070      3.07</span></span>
<span><span class="co">## 2002-10-03 1.189180 15.43700     0.828 25.74430      2.99</span></span>
<span><span class="co">## 2002-10-04 2.083260  8.76948     0.860 18.68610      3.06</span></span>
<span><span class="co">## 2002-10-05 6.474310  4.66501     0.903  9.82648      2.93</span></span>
<span><span class="co">## 2002-10-06 0.125591  4.20829     1.040  7.90952      3.15</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">flow36</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_hyd_extract.html">rvn_hyd_extract</a></span><span class="op">(</span><span class="st">"Sub36"</span>,<span class="va">hy</span><span class="op">)</span></span>
<span><span class="va">precip</span> <span class="op">&lt;-</span> <span class="va">hy</span><span class="op">$</span><span class="va">hyd</span><span class="op">$</span><span class="va">precip</span></span></code></pre></div>
<p>The hydrograph object flow36 now stores the simulated hydrograph
(<code>flow36$sim</code>) and the observed hydrograph
(<code>flow36$obs</code>), and the null subobject
(<code>flow36$inflow</code>). The precip object stores the entire time
series of watershed-averaged precip (<code>precip$sim</code>). We can
plot the simulated and observed hydrograph with the following commands
in base R, extracting the date:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/date.html" class="external-link">date</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span><span class="op">)</span>, <span class="va">flow36</span><span class="op">$</span><span class="va">sim</span>,col<span class="op">=</span><span class="st">'red'</span>,</span>
<span>     type<span class="op">=</span><span class="st">'l'</span>, panel.first<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/graphics/grid.html" class="external-link">grid</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu">lubridate</span><span class="fu">::</span><span class="fu"><a href="https://lubridate.tidyverse.org/reference/date.html" class="external-link">date</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span>, <span class="va">flow36</span><span class="op">$</span><span class="va">obs</span>,col<span class="op">=</span><span class="st">'black'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Plot%20hydrographs%20with%20other%20utilities-1.png" width="576"></p>
<p>A ggplot format plot can also be created using the
<code>rvn_hyd_plot</code> function in the RavenR library. This function
can save some of the trouble of plotting the precipitation on the
secondary axis.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_hyd_plot.html">rvn_hyd_plot</a></span><span class="op">(</span>sim<span class="op">=</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span>, obs<span class="op">=</span><span class="va">flow36</span><span class="op">$</span><span class="va">obs</span>, precip <span class="op">=</span> <span class="va">precip</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Create%20hydrograph-1.png" width="576"></p>
<p>There are some other helpful functions in RavenR for understanding
our hydrographs. For example, the ‘spaghetti’ plot overlays the
hydrographs from the supplied series and plots them against day of year
on the x-axis, facilitating a comparison across multiple years.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_flow_spaghetti.html">rvn_flow_spaghetti</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Spaghetti%20plot-1.png" width="576"></p>
<p>The annual quantiles function compute the flow quantiles for a given
time series for each day of the year, and plot those quantiles with the
corresponding plot function. This provides a similar look to the
spaghetti plot, but with smooth quantiles instead of overlaying time
series.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_annual_quantiles.html">rvn_annual_quantiles</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/rvn_annual_quantiles_plot.html">rvn_annual_quantiles_plot</a></span><span class="op">(</span><span class="va">.</span>, ribboncolor <span class="op">=</span> <span class="st">'magenta'</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Annual%20quantiles-1.png" width="576"></p>
<p>Other plots indicate the agreement between peak flows in the modelled
and observed.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_annual_peak.html">rvn_annual_peak</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span>, obs <span class="op">=</span> <span class="va">flow36</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## $df_peak</span></span>
<span><span class="co">##     date.end sim.peak obs.peak</span></span>
<span><span class="co">## 1 2003-09-30  98.1327     74.4</span></span>
<span><span class="co">## 2 2004-09-30 155.3560    168.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $p1</span></span></code></pre>
<p><img src="Introduction_to_RavenR_files/figure-html/Annual%20peak%20flows-1.png" width="576"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_annual_peak_event.html">rvn_annual_peak_event</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span>, obs <span class="op">=</span> <span class="va">flow36</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $df_peak_event</span></span>
<span><span class="co">##    obs.dates sim.peak.event obs.peak.event</span></span>
<span><span class="co">## 1 2003-03-23        35.7503           74.4</span></span>
<span><span class="co">## 2 2004-03-07        98.9858          168.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $p1</span></span></code></pre>
<p><img src="Introduction_to_RavenR_files/figure-html/Annual%20peak%20flows-2.png" width="576"></p>
<p>We can also use some of the Raven plots to get some diagnostics and
comparisons on the simulated and observed hydrographs. For example, the
plots below compare the annual cumulative flow and the monthly volume
bias, respectively.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_cum_plot_flow.html">rvn_cum_plot_flow</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span>, obs <span class="op">=</span> <span class="va">flow36</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Cumulative%20flow%20plot%20and%20monthly%20bias-1.png" width="576"></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_monthly_vbias.html">rvn_monthly_vbias</a></span><span class="op">(</span><span class="va">flow36</span><span class="op">$</span><span class="va">sim</span>, obs <span class="op">=</span> <span class="va">flow36</span><span class="op">$</span><span class="va">obs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $df.mvbias</span></span>
<span><span class="co">##         mvbias</span></span>
<span><span class="co">## Jan  14.218038</span></span>
<span><span class="co">## Feb -31.634886</span></span>
<span><span class="co">## Mar  15.934117</span></span>
<span><span class="co">## Apr -36.526804</span></span>
<span><span class="co">## May -61.526206</span></span>
<span><span class="co">## Jun -55.782838</span></span>
<span><span class="co">## Jul -69.457872</span></span>
<span><span class="co">## Aug -70.455088</span></span>
<span><span class="co">## Sep  35.169824</span></span>
<span><span class="co">## Oct   1.325446</span></span>
<span><span class="co">## Nov  83.761819</span></span>
<span><span class="co">## Dec  29.171061</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $plot</span></span></code></pre>
<p><img src="Introduction_to_RavenR_files/figure-html/Cumulative%20flow%20plot%20and%20monthly%20bias-2.png" width="576"></p>
</div>
<div class="section level4">
<h4 id="flow-dygraphs">Flow DyGraphs<a class="anchor" aria-label="anchor" href="#flow-dygraphs"></a>
</h4>
<p>A fun feature in the RavenR package is the addition of dygraphs,
which produces a dynamic hydrograph plot with a slider on the time
scale. This is particularly helpful for viewing subsections of a
hydrograph dynamically, and comparing the simulated and observed
hydrographs in an interactive environment. Only the output object from
the <code>rvn_hyd_read</code> function and the name of headings to
extract is required. Note that this interactive plot does not work well
in a PDF file, so try this out in R/RStudio.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rstudio/htmltools" class="external-link">htmltools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rvn_hyd_dygraph.html">rvn_hyd_dygraph</a></span><span class="op">(</span><span class="va">hy</span>, basins<span class="op">=</span><span class="st">"Sub36"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span><span class="fu">htmltools</span><span class="fu">::</span><span class="fu"><a href="https://rstudio.github.io/htmltools/reference/tagList.html" class="external-link">tagList</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>While this tutorial focuses on the forcing functions and hydrograph
data, similar routines exist for reading in the reservoir stages output,
the watershed mass energy balance files, and other Raven outputs.</p>
</div>
<div class="section level4">
<h4 id="ravenr-time-series-utilities">RavenR Time Series Utilities<a class="anchor" aria-label="anchor" href="#ravenr-time-series-utilities"></a>
</h4>
<p>One utility that does not exist in the <code>xts</code> package, but
is nonetheless useful in hydrology, is the application of functions to
the water year period rather than the calendar year. In the RavenR
package, the <code>rvn_apply_wyearly</code> function accomplishes this.
The water year is by default set to index by the October 1st water year
(specifying the period ending September 30th), but this may be provided
as an argument to the function for different water years. Here, we apply
the mean function to the water year using sample hydrograph data in
RavenR.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myhyd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"run1_Hydrographs.csv"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/rvn_hyd_read.html">rvn_hyd_read</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://joshuaulrich.github.io/xts/" class="external-link">xts</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># apply mean to calendar year in hydrograph data</span></span>
<span><span class="fu">xts</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/xts/man/apply.monthly.html" class="external-link">apply.yearly</a></span><span class="op">(</span><span class="va">myhyd</span><span class="op">$</span><span class="va">hyd</span><span class="op">$</span><span class="va">Sub36</span>, <span class="va">colMeans</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               Sub36</span></span>
<span><span class="co">## 2002-12-31 3.886438</span></span>
<span><span class="co">## 2003-12-31 4.962424</span></span>
<span><span class="co">## 2004-09-30 5.549967</span></span></code></pre>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># apply mean as FUN to daily average temperature</span></span>
<span><span class="fu">RavenR</span><span class="fu">::</span><span class="fu"><a href="../reference/rvn_apply_wyearly.html">rvn_apply_wyearly</a></span><span class="op">(</span><span class="va">myhyd</span><span class="op">$</span><span class="va">hyd</span><span class="op">$</span><span class="va">Sub36</span>, <span class="va">colMeans</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##               Sub36</span></span>
<span><span class="co">## 2003-09-30 3.994746</span></span>
<span><span class="co">## 2004-09-30 6.096847</span></span></code></pre>
</div>
</div>
<div class="section level3">
<h3 id="rvi-file-utilities">RVI File Utilities<a class="anchor" aria-label="anchor" href="#rvi-file-utilities"></a>
</h3>
<p>The RavenR package can read the rvi file and generate a network plot
of the model connections, which is helpful in understanding the model
configuration. This can be done as follows, again using the Nith rvi
file as an example. The network plot may be directly written to file by
supplying a file name to the <code>pdfout</code> argument, which is NULL
by default. Similar functionality is also avaialble with the
<code>rvn_rvi_process_diagrammer</code> function, which uses the
<code>DiagrammeR</code> library.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rvi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_rvi_read.html">rvn_rvi_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"Nith.rvi"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rvn_rvi_connections.html">rvn_rvi_connections</a></span><span class="op">(</span><span class="va">rvi</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/rvn_rvi_process_ggplot.html">rvn_rvi_process_ggplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/RVI%20connection%20plot%20example-1.png" width="700"></p>
<p>The Raven User’s Manual (Appendix D) provides a number of model
templates that can be used to emulate existing model structures or act
as starting points for modellers to then adapt to their applications.
The <code>rvn_rvi_write_template</code> function allows these templates
to be written directly to an rvi file, which reduces the effort in
creating these initial template files.</p>
<p>We can call this command to create a template rvi file for one of
these models as per below.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">td</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># temporary directory to write model files to</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">td</span>,<span class="st">"mymodel.rvi"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/rvn_rvi_write_template.html">rvn_rvi_write_template</a></span><span class="op">(</span>template_name<span class="op">=</span><span class="st">"HMETS"</span>,</span>
<span>                       filename<span class="op">=</span><span class="va">tf</span>,</span>
<span>                       author<span class="op">=</span><span class="st">"Your Name"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>This file can also be used in the rvp file tools to quickly develop
parameter files based on the model structure, discussed in the RVP
section.</p>
</div>
<div class="section level3">
<h3 id="rvh-file-utilities">RVH File Utilities<a class="anchor" aria-label="anchor" href="#rvh-file-utilities"></a>
</h3>
<p>The discretization file, rvh, may be read in and modified using the
RavenR package. The <code>rvn_rvh_read</code> function also computes the
upstream area of each subbasin. The corresponding
<code>rvn_rvh_write</code> function also writes the rvh object back to
file.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in rvh file</span></span>
<span><span class="va">rvh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_rvh_read.html">rvn_rvh_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"Nith.rvh"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">rvh</span><span class="op">$</span><span class="va">SBtable</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"SBID"</span>,<span class="st">"Downstream_ID"</span>,<span class="st">"Area"</span>,<span class="st">"TotalUpstreamArea"</span><span class="op">)</span><span class="op">]</span></span></code></pre></div>
<pre><code><span><span class="co">##    SBID Downstream_ID  Area TotalUpstreamArea</span></span>
<span><span class="co">## 30   30            36 318.5             318.5</span></span>
<span><span class="co">## 36   36            39 219.2             537.7</span></span>
<span><span class="co">## 39   39            43 271.7             809.4</span></span>
<span><span class="co">## 43   43            -1 205.0            1014.4</span></span></code></pre>
<p>Similar to the rvi functionality, the subbasin connections from the
rvh file may be plotted using one of two ways. The
<code>rvn_rvh_read</code> function has built-in functionality to build a
network plot, which may be plotted directly. The
<code>rvn_rvh_subbasin_network_plot</code> function uses the subbasin
table to plot the network from the lat/long coordinates, generating a
more spatially accurate plot.</p>
<p>Compare these two plots to the map of the Nith basin from Tutorial
#2.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot network from rvh file directly</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">rvh</span><span class="op">$</span><span class="va">SBnetwork</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Discretization%20network%20plot%20example-1.png" width="700"></p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create network plot of watershed structure from rvh file</span></span>
<span><span class="fu"><a href="../reference/rvn_rvh_subbasin_network_plot.html">rvn_rvh_subbasin_network_plot</a></span><span class="op">(</span><span class="va">rvh</span><span class="op">$</span><span class="va">SBtable</span>, labeled <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="Introduction_to_RavenR_files/figure-html/Discretization%20network%20plot%20example-2.png" width="700"></p>
<p>Another useful rvh functionality is the simplification of an HRU
file. Often in the initial HRU discretization, many HRUs with similar
properties and/or very small areas exist that are worthwhile
consolidating for the purpose of modelling. The
<code>rvn_rvh_cleanrhus</code> function accomplishes this. Try the
example in the help file - <code><a href="../reference/rvn_rvh_cleanhrus.html">?rvn_rvh_cleanhrus</a></code>.</p>
<p>Finally, rvh files can be created with the <code>rvn_rvh_write</code>
function, and the basic subbasin tabale and hru table can be created
with the <code>rvn_rvh_blankSBdf</code> and
<code>rvn_rvh_blankHRUdf</code> functions, respectively. More complex
discretizations would require some manual editing or other
discretization tools to first create this network.</p>
</div>
<div class="section level3">
<h3 id="rvp-utilities">RVP Utilities<a class="anchor" aria-label="anchor" href="#rvp-utilities"></a>
</h3>
<p>A number of useful rvp utilities may be found in the RavenR package
by searching for <code>?rvn_rvp_</code>. A useful workflow to create
initial rvp files based on the Raven templates is available, and
demonstrated below in a few steps.</p>
<p>An rvp template file could be generated by running Raven with the
<code>:CreateRVPTemplate</code> option in Raven.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/rvn_run.html">rvn_run</a></span><span class="op">(</span>fileprefix <span class="op">=</span> <span class="st">"mymodel"</span>,</span>
<span>        indir<span class="op">=</span><span class="va">td</span>, <span class="co"># temporary directory created earlier</span></span>
<span>        outdir<span class="op">=</span><span class="va">td</span>, <span class="co"># write to same temporary directory</span></span>
<span>        rvi_options<span class="op">=</span><span class="st">":CreateRVPTemplate"</span>,</span>
<span>        showoutput <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>From the rvp template file, the file can be infilled to a usable rvp
file using default values for parameter values and the various classes
and other information from the rvh file. Additional rvp options can be
added as well, such as average annual runoff and redirect file
commands.</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># temporary file path</span></span>
<span><span class="va">tf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># infill template file with default parameter values</span></span>
<span><span class="fu"><a href="../reference/rvn_rvp_fill_template.html">rvn_rvp_fill_template</a></span><span class="op">(</span></span>
<span>                      rvi_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"Nith.rvi"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span>,</span>
<span>                      rvh_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"Nith.rvh"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span>,</span>
<span>                      rvp_template_file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"nithmodel.rvp_temp.rvp"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span>,</span>
<span>                      avg_annual_runoff <span class="op">=</span> <span class="fl">123</span>,</span>
<span>                      extra_commands<span class="op">=</span><span class="st">":RedirectToFile  channel_properties.rvp"</span>,</span>
<span>                      rvp_out <span class="op">=</span> <span class="va">tf</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>A table of default values and ranges for parameters required in a
model may be obtained by use of the <code>rvn_rvi_getparams</code>
function, which reads the rvi file and uses the database files stored
with the RavenR installation to query any required parameters and their
information. This is demonstrated for the Nith model file below.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>,<span class="st">"Nith.rvi"</span>, package <span class="op">=</span> <span class="st">"RavenR"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="../reference/rvn_rvi_read.html">rvn_rvi_read</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/rvn_rvi_getparams.html">rvn_rvi_getparams</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># preview of parameter data frame</span></span></code></pre></div>
<pre><code><span><span class="co">##               param class_type     units  auto default min max</span></span>
<span><span class="co">## 1   FOREST_COVERAGE       LULT    [0..1] False       0   0   1</span></span>
<span><span class="co">## 5  IMPERMEABLE_FRAC       LULT    [0..1] False     0.0   0   1</span></span>
<span><span class="co">## 13  REFREEZE_FACTOR       LULT [mm/dC/d] False    5.04 0.0  10</span></span>
<span><span class="co">## 37         POROSITY       SOIL    [0..1]  True     0.4 0.0   1</span></span>
<span><span class="co">## 42   PET_CORRECTION       SOIL    [0..1]  True     1.0 0.0   1</span></span>
<span><span class="co">## 43   FIELD_CAPACITY       SOIL    [0..1]  True     0.0 0.0   1</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="rvt-file-utilities">RVT File Utilities<a class="anchor" aria-label="anchor" href="#rvt-file-utilities"></a>
</h3>
<p>The types of rvt files in Raven are plentiful, as rvt files are used
in Raven for time series observations, forcing data, gauge data, etc. A
handful of highly useful rvt utilities exist in the RavenR package for
reading and building these input files (, , and ). For example, gauge
observation data can be written to rvt format from the
<code>tidyhydat</code> package for scraping Water Survey of Canada
data.</p>
<p>Here, we use sample data from the <code>tidyhydat</code> function,
and write this to an rvt file for use within a Raven model. The commands
that would be used to extract data with the <code>tidyhydat</code>
function is also provided below (but commented out). The sample data is
used here to help meet compliance, but you are encouraged to try using
the <code>tidyhydat</code> commands to try this functionality for
yourself.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">stations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"05CB004"</span>,<span class="st">"05CA002"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Gather station data/info using tidyhydat functions</span></span>
<span><span class="co"># library(tidyhydat)</span></span>
<span><span class="co"># hd &lt;- tidyhydat::hy_daily_flows(station_number = stations,</span></span>
<span><span class="co">#  start_date = "1996-01-01", end_date = "1997-01-01")</span></span>
<span></span>
<span><span class="co">## load RavenR package sample data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rvn_tidyhydat_sample</span><span class="op">)</span></span>
<span><span class="va">hd</span> <span class="op">&lt;-</span> <span class="va">rvn_tidyhydat_sample</span></span>
<span></span>
<span><span class="va">tf1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"station1.rvt"</span><span class="op">)</span></span>
<span><span class="va">tf2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"station2.rvt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create RVT files</span></span>
<span><span class="fu"><a href="../reference/rvn_rvt_tidyhydat.html">rvn_rvt_tidyhydat</a></span><span class="op">(</span><span class="va">hd</span>, subIDs<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">11</span><span class="op">)</span>,</span>
<span>  filename<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">tf1</span>,<span class="va">tf2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># preview first 6 lines of rvt file 1</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">tf1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Similar support for the <code>weathercan</code> package to write
gauge forcing data exists within the <code>RavenR</code> package through
the <code>rvn_rvt_write_met</code> function. The
<code>rvn_rvt_write_met</code> function supports writing of all valid
Raven forcing information, and will write all supplied (valid) data to
rvt file. Here, we use the function to write the total precipitation,
maximum daily temperature, and minimum daily temperature from the
‘Kamloops A’ station to a Raven-compliant rvt format. The station
metadata, also required for Raven gauge forcing data, is written to a
separate file. The sample data within RavenR is used once again, this
time using the sample data obtained from the <code>weathercan</code>.
However, you are encouraged to try obtaining the data from the
<code>weathercan</code> package directly using the commented out
commands below.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Obtain data using the weathercan package</span></span>
<span><span class="co"># library(weathercan)</span></span>
<span><span class="co"># kam &lt;- weather_dl(station_ids = 51423,</span></span>
<span><span class="co">#                   start = "2016-10-01", end = "2019-09-30", interval="day")</span></span>
<span></span>
<span><span class="co">## load RavenR package sample data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">rvn_weathercan_sample</span><span class="op">)</span></span>
<span><span class="va">kam</span> <span class="op">&lt;-</span> <span class="va">rvn_weathercan_sample</span></span>
<span></span>
<span><span class="va">fpath1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"met_data.rvt"</span><span class="op">)</span></span>
<span><span class="va">fpath2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"met_gauges.rvt"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## basic use, provide temporary file names for writing</span></span>
<span><span class="co">## filter for particular columns to write to file</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="va">kam</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"station_name"</span>,<span class="st">"date"</span>,<span class="st">"lat"</span>,<span class="st">"lon"</span>,<span class="st">"elev"</span>,<span class="st">"max_temp"</span>,<span class="st">"min_temp"</span>,<span class="st">"total_precip"</span><span class="op">)</span><span class="op">]</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>            <span class="fu"><a href="../reference/rvn_rvt_write_met.html">rvn_rvt_write_met</a></span><span class="op">(</span>metdata <span class="op">=</span> <span class="va">.</span>, </span>
<span>                        filenames <span class="op">=</span> <span class="va">fpath1</span>,</span>
<span>                        filename_stndata <span class="op">=</span> <span class="va">fpath2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "Imported data from 1 station"</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># preview files</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fpath1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># data rvt file</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] ":MultiData"                            </span></span>
<span><span class="co">## [2] "  2016-10-01 00:00:00 1 1095"          </span></span>
<span><span class="co">## [3] "  :Parameters TEMP_MAX TEMP_MIN PRECIP"</span></span>
<span><span class="co">## [4] "  :Units DegC DegC mm/d"               </span></span>
<span><span class="co">## [5] "  16.8 5.5 0"                          </span></span>
<span><span class="co">## [6] "  18.1 2.5 0"</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/readLines.html" class="external-link">readLines</a></span><span class="op">(</span><span class="va">fpath2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># gauge data file</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] ":Gauge KAMLOOPS_A"                             </span></span>
<span><span class="co">## [2] "  :Latitude 50.700000"                         </span></span>
<span><span class="co">## [3] "  :Longitude -120.450000"                      </span></span>
<span><span class="co">## [4] "  :Elevation 345.30"                           </span></span>
<span><span class="co">## [5] "  :RedirectToFile /tmp/RtmpkGmusD/met_data.rvt"</span></span>
<span><span class="co">## [6] ":EndGauge"</span></span></code></pre>
<div style="page-break-after: always;"></div>
</div>
</div>
<div class="section level2">
<h2 id="exercise-1---build-a-model-workflow">Exercise 1 - Build a model workflow<a class="anchor" aria-label="anchor" href="#exercise-1---build-a-model-workflow"></a>
</h2>
<p>Now we will build a simple script which will provide a number of
visualizations, which we can use to look at the Nith river model each
time we run it. This can be made as complex as you want. You may also
choose to run this for a different Raven model as part of this
exercise.</p>
<div class="section level3">
<h3 id="building-a-model-workflow-script">Building a model workflow script<a class="anchor" aria-label="anchor" href="#building-a-model-workflow-script"></a>
</h3>
<p>Start with a new script. From RStudio, go to the main menu.
<code>Choose File -&gt; New File -&gt; R Script</code>. Populate the
script with the following.</p>
<p>You can find the Nith model files in the Raven Tutorials. Please
place a Raven.exe executable (or symbolic link called Raven.exe) inside
this Nith folder, and update the modelfolder variable below to the
appropriate folder location on your system.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelfolder</span> <span class="op">&lt;-</span> <span class="st">"C:/TEMP/Nith/"</span>  <span class="co"># model folder with Raven.exe and Nith model files</span></span>
<span><span class="va">fileprefix</span> <span class="op">&lt;-</span> <span class="st">"Nith"</span>            <span class="co"># prefix for model files (i.e. Nith.rvi should be in the modelfolder) </span></span>
<span><span class="va">outdir</span> <span class="op">&lt;-</span> <span class="st">"./output/"</span></span>
<span></span>
<span><span class="co">## if this generates an error for you, the Nith folder cannot be found. </span></span>
<span><span class="co"># Please update the modelfolder variable accordingly </span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.exists</a></span><span class="op">(</span><span class="va">modelfolder</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"The folder %s does not exist, please verify!"</span>, <span class="va">modelfolder</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">setwd</a></span><span class="op">(</span><span class="va">modelfolder</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># RUN RAVEN</span></span>
<span><span class="co"># =====================================================</span></span>
<span><span class="co"># writes complete command prompt command (Windows)</span></span>
<span><span class="co"># &gt; Raven.exe [filename] -o [outputdir]</span></span>
<span><span class="va">RavenCMD</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"Raven.exe %s -o %s"</span>, <span class="va">fileprefix</span>, <span class="va">outdir</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># or adjust string if in a macos/ linux environemnt</span></span>
<span><span class="co"># RavenCMD &lt;- sprintf("./Raven.exe %s -o %s", fileprefix, outdir)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/system.html" class="external-link">system</a></span><span class="op">(</span><span class="va">RavenCMD</span><span class="op">)</span> <span class="co"># this runs raven from the command prompt</span></span></code></pre></div>
<p>Once the model is run, we can read in the output and save some of the
plots to file. Here, we examine the forcing data and the snowpack.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GENERATE OUTPUT PLOTS</span></span>
<span><span class="co"># =====================================================</span></span>
<span><span class="co"># read in the model output files</span></span>
<span></span>
<span><span class="co">## use ggsave from ggplot2 to save plot pdf</span></span>
<span><span class="va">ff_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_forcings_read.html">rvn_forcings_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>,<span class="st">"run1_ForcingFunctions.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">myplots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_forcings_plot.html">rvn_forcings_plot</a></span><span class="op">(</span><span class="va">ff_data</span><span class="op">$</span><span class="va">forcings</span><span class="op">)</span></span>
<span><span class="va">myplots</span><span class="op">$</span><span class="va">AllForcings</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="st">"Forcings.pdf"</span>, <span class="va">.</span>, width <span class="op">=</span> <span class="fl">8.5</span>, height<span class="op">=</span><span class="fl">11</span>, units<span class="op">=</span><span class="st">'in'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot snowpack from xts format, save using base R commands</span></span>
<span><span class="va">mywshd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rvn_watershed_read.html">rvn_watershed_read</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">outdir</span>, <span class="st">"run1_WatershedStorage.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span><span class="st">"snowpack.png"</span><span class="op">)</span> <span class="co"># create a png file to direct plot to</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">mywshd</span><span class="op">$</span><span class="va">watershed_storage</span><span class="op">$</span><span class="va">Snow</span>, </span>
<span>     main<span class="op">=</span><span class="st">'Snowpack (mm SWE)'</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span> <span class="co">#finishes writing plot to .png file</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="modify-the-script">Modify the script<a class="anchor" aria-label="anchor" href="#modify-the-script"></a>
</h3>
<p>Modify the above script to generate png image plots of monthly
subbasin-averaged PET in Subbasin 43 using the :CustomOutput option (you
will have to add a :CustomOutput command to the Raven input rvi file).
You will also want to use the RavenR <code><a href="../reference/rvn_custom_read.html">rvn_custom_read()</a></code> and
<code><a href="../reference/rvn_custom_output_plot.html">rvn_custom_output_plot()</a></code> commands.</p>
<p>Then, add a set of diagnostic plots related to the Hydrographs.csv
file. For example, you may wish to compare annual peaks in the data or
flow volumes.</p>
</div>
</div>
<div class="section level2">
<h2 id="exercise-2---build-raven-input-rvt-files">Exercise 2 - Build Raven Input rvt Files<a class="anchor" aria-label="anchor" href="#exercise-2---build-raven-input-rvt-files"></a>
</h2>
<p>If you have completed the workflow exercise above, you may build on
the Introduction to R exercise from the earlier session to build
Raven-compliant input files for the Raven River in Alberta. Using your
knowledge of R and RavenR, undertake the following tasks using only R
and a text file editor.</p>
<ul>
<li>build an rvt file of daily observed hydrograph flows from the Raven
River WSC gauge; and<br>
</li>
<li>build rvt file(s) for at least one daily meteorological gauge
located close to the WSC gauge (within 10km).</li>
</ul>
<p>Based on the meteorological information in the station(s), would
there be sufficient meteorological information to run a model of the
Raven River? What else would be required?</p>
</div>
<div class="section level2">
<h2 id="exercise-3---build-additional-raven-input-files">Exercise 3 - Build Additional Raven Input files<a class="anchor" aria-label="anchor" href="#exercise-3---build-additional-raven-input-files"></a>
</h2>
<p>Following up from Exercise 2, let’s say that we want to continue
building model files for Raven River, continuing with an rvi, rvh and
rvp file. We can use the <code>rvn_rvi_write_template</code> file and
the other utilities for rvi/rvp files to create these two files directly
with the RavenR package. We can also create a basic rvh file with
asasigned properties in R with the RavenR package.</p>
<p>For this exercise, you should do the following. Create any new model
files with the prefix “ravenriver”, for example, “ravenriver.rvi”.</p>
<ol style="list-style-type: decimal">
<li>Select a model template option for the
<code>rvn_rvi_write_template</code> function, and create the file
ravenriver.rvi with this template.</li>
<li>Create the rvp template file using Raven, called in R or
otherwise.</li>
<li>Create a basic rvh file called ravenriver.rvh with 1 subbasin and 2
HRUs.</li>
<li>Create an infilled rvp file called ravenriver.rvp from the rvp
template file using RavenR.</li>
</ol>
</div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a>
</h2>
<p>This tutorial is meant to serve as a brief introduction to the RavenR
package. If you have any comments, suggestions or bug reports, please
leave a note on the issues page of the Github project (<a href="https://github.com/rchlumsk/RavenR" class="external-link">RavenR Github page</a>), email
the authors of the package, or feel free to let us know on the <a href="http://www.civil.uwaterloo.ca/raven_forum/" class="external-link">Raven forum</a>.</p>
<p>Additional Raven materials can be found on the <a href="http://www.civil.uwaterloo.ca/jrcraig/Raven/Downloads.html" class="external-link">Raven
downloads page</a>, and additional RavenR vignettes can be found on
Github in the <a href="https://github.com/rchlumsk/RavenR/tree/master/vignettes" class="external-link">vignettes
folder</a>.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Robert Chlumsky, James Craig, Leland Scantlebury, Simon Lin, Sarah Grass, Genevieve Brown, Rezgar Arabzadeh.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
